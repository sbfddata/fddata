<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Samaurdhi Investment System</title>
    <style>
        body { font-family: 'Arial', sans-serif; font-size: 11pt; background: #f0f2f5; }
        .no-print { max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 4px; border: 1px solid #ccc; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .add { background: #27ae60; color: white; }
        .print4 { background: #8e44ad; color: white; }
        .print5 { background: #2c3e50; color: white; }
        
        /* Reports Styling */
        #attch4, #attch5 { display: none; background: white; padding: 20mm; color: black; }
        .report-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 9pt; }
        th, td { border: 1px solid black; padding: 5px; text-align: center; }
        .title { text-align: center; font-weight: bold; text-decoration: underline; font-size: 14pt; margin: 15px 0; }

        @media print {
            .no-print { display: none; }
            #attch4, #attch5 { display: block; }
            @page { size: A4 landscape; margin: 5mm; }
            .portrait-page { @page { size: A4 portrait; } }
        }
    </style>
</head>
<body>

<div id="login-screen" class="no-print">
    <h2 style="text-align:center">LOGIN</h2>
    <input type="text" id="user" placeholder="Username">
    <input type="password" id="pass" placeholder="Password">
    <button onclick="login()" style="background:#008080; color:white">Login</button>
</div>

<div id="main-system" class="no-print" style="display:none">
    <input type="text" id="sId" placeholder="‡∑É‡∑ô‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫">
    <button onclick="search()">üîç Search</button>
    <hr>
    <label>‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä:</label><select id="a"><option>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option></select>
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∑í‡∂≠ ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä:</label><input type="text" id="b">
    <label>‡∂Ø‡∑í‡∂±‡∂∫:</label><input type="date" id="c">
    <label>‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label><input type="text" id="d">
    <label>‡∂∏‡∑î‡∂Ø‡∂Ω:</label><input type="number" id="e">
    <label>‡∂ö‡∑è‡∂Ω‡∂∫:</label><input type="text" id="f">
    <label>‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫:</label><input type="date" id="g">
    <label>‡∂¥‡∑ú‡∂Ω‡∑ì %:</label><input type="text" id="h">
    <label>‡∂Ω‡∂Ø ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫:</label><input type="number" id="i">
    <label>‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label><input type="text" id="j">

    <div class="btn-grid">
        <button class="add" onclick="save()">Data Add</button>
        <button class="print4" onclick="print4()">Print (Attch 4)</button>
        <button class="print5" onclick="print5()">Print List (Attch 5)</button>
        <button onclick="clearL()" style="grid-column: span 2; background:#7f8c8d; color:white">Clear List</button>
    </div>
</div>

<div id="attch4" class="portrait-page">
    <div class="report-header">
        <div>‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∑î,<br><span id="p4_acc"></span>.</div>
        <div style="text-align:right">‡∂á‡∂∏‡∑î‡∂´‡∑î‡∂∏ 4<br>‡∂Ø‡∑í‡∂±‡∂∫: <span id="p4_date"></span></div>
    </div>
    <div class="title">‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∑Ñ‡∑è ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ ‡∂ë‡∑Ä‡∑ì‡∂∏</div>
    <p>‡∂â‡∑Ñ‡∂≠ ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫‡∂ß ‡∂Ö‡∂Ø‡∑è‡∑Ö‡∑Ä <span id="p4_check" style="font-weight:bold"></span> ‡∂Ø‡∂ª‡∂´ ‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠ ‡∂∏‡∂ü‡∑í‡∂±‡∑ä ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∂ë‡∑Ä‡∂∏‡∑î.</p>
    </div>

<div id="attch5">
    <div class="report-header">
        <div>‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∑î,<br>‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫,<br>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä.</div>
        <div style="text-align:right">‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫<br>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä<br>‡∂Ø‡∑í‡∂±‡∂∫:- <span id="p5_date"></span></div>
    </div>
    <div class="title">‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ ‡∑Ñ‡∑è ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂ë‡∑Ä‡∑í‡∂∏‡∑ö ‡∂±‡∑í‡∑Ä‡∑ö‡∂Ø‡∂±‡∂∫</div>
    <p style="text-align:center">‡∂¥‡∑Ñ‡∂≠ ‡∑É‡∂≥‡∑Ñ‡∂±‡∑ä ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∑Ä‡∂Ω‡∂ß ‡∂Ö‡∂Ø‡∑è‡∂Ω‡∑Ä <span id="p5_check" style="font-weight:bold"></span> ‡∂Ø‡∂ª‡∂´ ‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠ ‡∂∏‡∂ü‡∑í‡∂±‡∑ä ‡∂Ö‡∂∏‡∑î‡∂´‡∑è ‡∂ë‡∑Ä‡∂∏‡∑î.</p>
    <table id="p5_table">
        <thead>
            <tr>
                <th rowspan="2">‡∂Ö‡∂Ç‡∂ö‡∂∫</th><th colspan="3">‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑î‡∂´‡∑î ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±</th><th colspan="3">‡∂¥‡∑ú‡∂Ω‡∑ì ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª</th><th colspan="6">‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±</th>
            </tr>
            <tr>
                <th>‡∂∏‡∑î‡∂Ø‡∂Ω</th><th>‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</th><th>‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠</th><th>‡∂∏‡∑î‡∑Ö‡∑î ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫</th><th>7% ‡∂∂‡∂Ø‡∑ä‡∂Ø</th><th>‡∑Å‡∑î‡∂Ø‡∑ä‡∂∞ ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫</th><th>‡∂Ø‡∑í‡∂±‡∂∫</th><th>‡∂∏‡∑î‡∂Ø‡∂Ω</th><th>‡∑Ä‡∂ª‡∑ä‡∂ú‡∂∫</th><th>‡∂ö‡∑è‡∂Ω‡∂∫</th><th>‡∂¥‡∑ú‡∂Ω‡∑ì %</th><th>‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫</th>
            </tr>
        </thead>
        <tbody id="p5_body"></tbody>
    </table>
    <div style="display:flex; justify-content:space-between; margin-top:40px">
        <div>‡∂ú‡∑í‡∂´‡∑î‡∂∏‡∑ä ‡∂Ω‡∑í‡∂¥‡∑í‡∂ö‡∂ª‡∑î<br>‡∂Ö‡∂≠‡∑ä‡∑É‡∂±:......................</div>
        <div>‡∂∂‡∂Ω‡∂∫‡∂Ω‡∂≠‡∑ä ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑ì<br>‡∂Ö‡∂≠‡∑ä‡∑É‡∂±:......................</div>
    </div>
</div>

<script>
    const URL = "https://script.google.com/macros/s/AKfycbwM3j8A4oy8nVqC7zycyuGonaK2SzfywxLGaS9-rxWpJkPqf8ta9E_oiKIl1oc-1LkNig/exec";

    async function login() {
        const res = await fetch(`${URL}?action=login&username=${document.getElementById('user').value}&password=${document.getElementById('pass').value}`, {method:'POST'});
        const text = await res.text();
        if(text.trim()==="success") { document.getElementById('login-screen').style.display='none'; document.getElementById('main-system').style.display='block'; }
        else alert("Login Failed!");
    }

    async function search() {
        const res = await fetch(`${URL}?action=searchData&colD=${document.getElementById('sId').value}`, {method:'POST'});
        const d = await res.json();
        if(d) {
            document.getElementById('b').value = d[1];
            document.getElementById('c').value = new Date(d[2]).toISOString().split('T')[0];
            document.getElementById('d').value = d[3];
            document.getElementById('e').value = d[4];
            document.getElementById('f').value = d[5];
            document.getElementById('g').value = new Date(d[6]).toISOString().split('T')[0];
            document.getElementById('h').value = d[7];
            document.getElementById('i').value = d[8];
            document.getElementById('j').value = d[9];
        }
    }

    async function save() {
        let p = new URLSearchParams();
        ['a','b','c','d','e','f','g','h','i','j'].forEach(k => p.append('col'+k.toUpperCase(), document.getElementById(k).value));
        p.append('action', 'addData');
        await fetch(`${URL}?${p.toString()}`, {method:'POST'});
        alert("Saved!");
    }

    async function print5() {
        const res = await fetch(`${URL}?action=getPrintList`);
        const data = await res.json();
        let body = document.getElementById('p5_body');
        body.innerHTML = "";
        data.forEach((r, idx) => {
            let tax = r[8] * 0.07;
            body.innerHTML += `<tr><td>${idx+1}</td><td>${r[4]}</td><td>${r[1]}</td><td>${r[3]}</td><td>${r[8]}</td><td>${tax.toFixed(2)}</td><td>${(r[8]-tax).toFixed(2)}</td><td>${r[2]}</td><td>${r[4]}</td><td>‡∑É‡∑ä‡∂Æ‡∑ì‡∂ª</td><td>${r[5]}</td><td>${r[7]}</td><td>${r[6]}</td></tr>`;
        });
        document.getElementById('p5_check').innerText = document.getElementById('j').value;
        document.getElementById('p5_date').innerText = new Date().toLocaleDateString();
        window.print();
    }

    function print4() {
        document.getElementById('p4_acc').innerText = document.getElementById('a').value;
        document.getElementById('p4_date').innerText = new Date().toLocaleDateString();
        document.getElementById('p4_check').innerText = document.getElementById('j').value;
        window.print();
    }

    async function clearL() { if(confirm("Clear?")) await fetch(`${URL}?action=clearPrintSheet`, {method:'POST'}); }
</script>
</body>
</html>

