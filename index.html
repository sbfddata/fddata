<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment System Pro - Padiyathalawa</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; padding: 0; }
        .header { background: #90caf9; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
        .container { background: white; max-width: 600px; margin: 20px auto; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* Search Box Style */
        .search-container { background: #fffde7; padding: 15px; border: 1px solid #fbc02d; border-radius: 8px; margin-bottom: 20px; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; cursor: pointer; border: none; border-radius: 5px; color: white; font-weight: bold; }
        .search-btn { background: #f1c40f; color: black; width: 100%; margin-top: 10px; }
        .add { background: #2ecc71; } 
        .edit { background: #3498db; } .delete { background: #e74c3c; }
        
        #login-area { text-align: center; } #system-area { display: none; }
        .auto-calc { color: #d32f2f; font-size: 12px; font-weight: normal; }
    </style>
</head>
<body>

<div class="header">‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∂∏‡∑ñ‡∂Ω ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂∏‡∑í‡∂≠‡∑í‡∂∫ - ‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä</div>

<div id="login-area" class="container">
    <h3 style="color: purple;">LOGIN</h3>
    <input type="text" id="user" placeholder="UserName">
    <input type="password" id="pass" placeholder="Password">
    <button style="background: #00bcd4; width: 100%;" onclick="doLogin()">Login</button>
</div>

<div id="system-area" class="container">
    <h3 style="color: purple; text-align: center;">Investment Management Information System</h3>
    
    <div class="search-container">
        <label>Enter receipt number:</label>
        <input type="text" id="searchId" placeholder="Enter receipt number to search data">
        <button class="search-btn" onclick="process('searchData')">üîç Data Search</button>
    </div>

    <hr>

    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂Ö‡∂∫‡∂≠‡∑ä ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä / ‡∂ú‡∑í‡∂´‡∑î‡∂∏‡∑ö ‡∂±‡∂∏:</label>
    <select id="colA" required>
        <option value="" disabled selected hidden>Select Investment Account...</option>
        <option value="‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂¥‡∂Ω‡∑ä‡∂Ω‡∑ö‡∂ú‡∂∏ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∂Ω‡∑ä‡∂Ω‡∑ö‡∂ú‡∂∏ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∑ä ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω">‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∑ä ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω</option>
        <option value="‡∂´‡∂∫ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä">‡∂´‡∂∫ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä</option>
        <option value="‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä">‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä</option>
    </select>

    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∑Ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä‡∑ö ‡∂±‡∂∏:</label>
    <select id="colB" required>
        <option value="" disabled selected hidden>Select Bank...</option>
        <option value="‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂∏‡∑Ñ‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂∏‡∑Ñ‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂Ø‡∑ö‡∑Å‡∑ì‡∂∫ ‡∑É‡∂Ç‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂Ø‡∑ö‡∑Å‡∑ì‡∂∫ ‡∑É‡∂Ç‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂±‡∑í‡∑Ä‡∑è‡∑É ‡∑É‡∂Ç‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∂∏‡∑ñ‡∂Ω‡∑ä‚Äç‡∂∫ ‡∑É‡∂Ç‡∑É‡∑ä‡∂Æ‡∑è‡∑Ä">‡∂±‡∑í‡∑Ä‡∑è‡∑É ‡∑É‡∂Ç‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∂∏‡∑ñ‡∂Ω‡∑ä‚Äç‡∂∫ ‡∑É‡∂Ç‡∑É‡∑ä‡∂Æ‡∑è‡∑Ä</option>
        <option value="‡∂ª‡∑è‡∂¢‡∑ä‚Äç‡∂∫ ‡∂ã‡∂ö‡∑É‡∑ä ‡∑Ñ‡∑è ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂ª‡∑è‡∂¢‡∑ä‚Äç‡∂∫ ‡∂ã‡∂ö‡∑É‡∑ä ‡∑Ñ‡∑è ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂¢‡∑è‡∂≠‡∑í‡∂ö ‡∂â‡∂≠‡∑í‡∂ª‡∑í‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¢‡∑è‡∂≠‡∑í‡∂ö ‡∂â‡∂≠‡∑í‡∂ª‡∑í‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
    </select>

    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ö‡∑Ö ‡∂Ø‡∑í‡∂±‡∂∫:</label>
    <input type="date" id="colC" onchange="calculateDuration()">

    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label>
    <input type="text" id="colD" >

    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î):</label>
    <input type="number" id="colE">   
   
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫:</label>
    <input type="date" id="colG" onchange="calculateDuration()">
    
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ö‡∑è‡∂Ω‡∂∫: </label>
    <select id="colF" disabled>  
        <option value="" selected>Investment period is automatically selected</option>
        <option value="‡∂∏‡∑è‡∑É 01">‡∂∏‡∑è‡∑É 01‡∂ö‡∑í </option>
        <option value="‡∂∏‡∑è‡∑É 03">‡∂∏‡∑è‡∑É 03‡∂ö‡∑í </option>
        <option value="‡∂∏‡∑è‡∑É 06">‡∂∏‡∑è‡∑É 06‡∂ö‡∑í </option>
    </select>
    
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑ú‡∂Ω‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∑Å‡∂≠‡∂∫:</label>
    <input type="text" id="colH">
    
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂Ω‡∂Ø ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫:</label>
    <input type="text" id="colH">

    <label>‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label>
    <input type="text" id="colI">

    <div class="btn-grid">
        <button class="add" onclick="process('addData')">Data Add</button>
        <button class="edit" onclick="process('editData')">Data Edit</button>
        <button class="delete" onclick="process('deleteData')">Data Delete</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxUbAp5A9v16LhlzTMQkrv1agi7OqEPNgSa-CfU_CBs106TAlD4I5Cp5tJTjLHvqOaLUA/exec";

    function doLogin() {
        let u = document.getElementById('user').value;
        let p = document.getElementById('pass').value;
        fetch(`${SCRIPT_URL}?action=login&username=${u}&password=${p}`, {method: 'POST'})
        .then(r => r.text())
        .then(res => {
            if(res.trim() === "success") {
                document.getElementById('login-area').style.display='none';
                document.getElementById('system-area').style.display='block';
            } else { alert("Incorrect username or password!"); }
        });
    }

    function calculateDuration() {
        let startDate = new Date(document.getElementById('colC').value);
        let endDate = new Date(document.getElementById('colG').value);
        let durationSelect = document.getElementById('colF');
        
        if (!isNaN(startDate) && !isNaN(endDate)) {
            let diffTime = Math.abs(endDate - startDate);
            let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            
            if (diffDays >= 28 && diffDays <= 32) {
                durationSelect.value = "‡∂∏‡∑è‡∑É 01";
            } else if (diffDays >= 88 && diffDays <= 94) {
                durationSelect.value = "‡∂∏‡∑è‡∑É 03";
            } else if (diffDays >= 175 && diffDays <= 184) {
                durationSelect.value = "‡∂∏‡∑è‡∑É 06";
            } else {
                durationSelect.value = ""; 
            }
        }
    }

    async function process(actionName) {
        let fields = ['colA','colB','colC','colD','colE','colF','colG','colH','colI'];
        let params = new URLSearchParams();
        
        if(actionName === 'searchData') {
            let sId = document.getElementById('searchId').value;
            if(!sId) { alert("Please enter the receipt number to search!"); return; }
            params.append('colD', sId);
        } else {
            fields.forEach(f => params.append(f, document.getElementById(f).value));
        }
        
        params.append('action', actionName);

        try {
            let response = await fetch(`${SCRIPT_URL}?${params.toString()}`, {method: 'POST'});
            let text = await response.text();
            
            try {
                let data = JSON.parse(text);
                if(actionName === 'searchData') {
                    fields.forEach((f, i) => {
                        let element = document.getElementById(f);
                        if((i === 2 || i === 6) && data[i]) {
                            // Date formatting for input type="date"
                            let dateVal = new Date(data[i]);
                            if (!isNaN(dateVal)) {
                                element.value = dateVal.toISOString().split('T')[0];
                            }
                        } else {
                            // If data is empty, set value to "" to show placeholder
                            element.value = (data[i] !== undefined && data[i] !== null) ? data[i] : "";
                        }
                    });
                    calculateDuration(); 
                    alert("Data found!");
                }
            } catch(e) {
                alert("Response: " + text);
                if(actionName !== 'searchData' && text.toLowerCase().includes("success")) location.reload();
            }
        } catch(err) {
            alert("Error!: " + err.message);
        }
    }
</script>
</body>
</html>












