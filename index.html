<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment System Pro - Padiyathalawa</title>
    <style>
        body { font-family: sans-serif; font-size: 12pt; line-height: 1.2; background-color: #f4f7f6; margin: 0; padding: 0; }
        .header { background: #90caf9; padding: 20px; text-align: center; font-size: 18pt; font-weight: bold; }
        .container { background: white; max-width: 700px; margin: 20px auto; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 14px; text-align: left; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; cursor: pointer; border: none; border-radius: 5px; color: white; font-weight: bold; transition: 0.3s; }
        .search-btn { background: #f1c40f; color: black; width: 100%; margin-top: 10px; }
        .add { background: #2ecc71; } 
        .delete { background: #e74c3c; }
        .print-single { background: #9b59b6; }
        .print-summary { background: #34495e; }
        
        #login-area { text-align: center; } #system-area { display: none; }
        hr { margin: 20px 0; border: 0; border-top: 1px solid #eee; }

        /* Report Styles */
        #report-area, #summary-report-area { display: none; background: white; width: 210mm; min-height: 297mm; margin: auto; padding: 15mm; box-sizing: border-box; }
        .bold { font-weight: bold; }
        .header-container { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; width: 100%; }
        .header-left { flex-basis: 50%; margin-top: 3.5em; text-align: left; }
        .header-right { flex-basis: 50%; display: flex; flex-direction: column; align-items: flex-end; text-align: left; }
        .report-title { font-size: 14pt; font-weight: bold; text-align: center; text-decoration: underline; margin: 15px 0; }
        
        /* Tables */
        .data-table, .investment-table, .summary-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .data-table td, .investment-table td, .summary-table th, .summary-table td { border: 1px solid #000; padding: 6px 8px; vertical-align: top; }
        .summary-table th { background-color: #f2f2f2; text-align: center; }
        
        .signature-section { display: flex; justify-content: space-between; margin-top: 40px; align-items: flex-start; width: 100%; }

        @media print {
            @page { size: A4; margin: 0; }
            body { background: none; }
            .header, .container { display: none !important; }
            #report-area.active, #summary-report-area.active { display: block !important; width: 100%; padding: 15mm; }
        }
    </style>
</head>
<body>

<div class="header">‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∂∏‡∑ñ‡∂Ω ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂∏‡∑í‡∂≠‡∑í‡∂∫ - ‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä</div>

<div id="login-area" class="container">
    <h3 style="color: purple;">LOGIN</h3>
    <input type="text" id="user" placeholder="UserName">
    <input type="password" id="pass" placeholder="Password">
    <button style="background: #00bcd4; width: 100%;" onclick="doLogin()">Login</button>
</div>

<div id="system-area" class="container">
    <h3 style="color: purple; text-align: center;">Investment Management Information System</h3>
    <div class="search-container">
        <label>Enter receipt number:</label>
        <input type="text" id="searchId" placeholder="Enter receipt number to search data">
        <button class="search-btn" onclick="process('searchData')">üîç Data Search</button>
    </div>
    <hr>
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂Ö‡∂∫‡∂≠‡∑ä ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä / ‡∂ú‡∑í‡∂´‡∑î‡∂∏‡∑ö ‡∂±‡∂∏:</label>
    <select id="colA">
        <option value="‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂¥‡∂Ω‡∑ä‡∂Ω‡∑ö‡∂ú‡∂∏ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∂Ω‡∑ä‡∂Ω‡∑ö‡∂ú‡∂∏ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∑ä ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω">‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∑ä ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω</option>
        <option value="‡∂´‡∂∫ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä">‡∂´‡∂∫ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä</option>
        <option value="‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä">‡∑É‡∂∏‡∑ñ‡∑Ñ ‡∑É‡∂Ç‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂Ö‡∂ª‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä</option>
    </select>
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∑Ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä‡∑ö ‡∂±‡∂∏:</label>
    <select id="colB">
        <option value="‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂∏‡∑Ñ‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂∏‡∑Ñ‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂Ø‡∑ö‡∑Å‡∑ì‡∂∫ ‡∑É‡∂Ç‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂Ø‡∑ö‡∑Å‡∑ì‡∂∫ ‡∑É‡∂Ç‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
        <option value="‡∂¢‡∑è‡∂≠‡∑í‡∂ö ‡∂â‡∂≠‡∑í‡∂ª‡∑í‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¢‡∑è‡∂≠‡∑í‡∂ö ‡∂â‡∂≠‡∑í‡∂ª‡∑í‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option>
    </select>
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ö‡∑Ö ‡∂Ø‡∑í‡∂±‡∂∫:</label><input type="date" id="colC" onchange="calculateDuration()">
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label><input type="text" id="colD">
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î):</label><input type="number" id="colE">   
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫:</label><input type="date" id="colG" onchange="calculateDuration()">
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ö‡∑è‡∂Ω‡∂∫: </label>
    <select id="colF">  
        <option value="‡∂∏‡∑è‡∑É 01">‡∂∏‡∑è‡∑É 01‡∂ö‡∑í</option>
        <option value="‡∂∏‡∑è‡∑É 03">‡∂∏‡∑è‡∑É 03‡∂ö‡∑í</option>
        <option value="‡∂∏‡∑è‡∑É 06">‡∂∏‡∑è‡∑É 06‡∂ö‡∑í</option>
    </select>
    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑ú‡∂Ω‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∑Å‡∂≠‡∂∫:</label><input type="text" id="colH" onblur="addPercentSymbol(this)">
    <label>‡∂Ω‡∂Ø ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ (‡∂ª‡∑î):</label><input type="text" id="colI">
    <label>‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label><input type="text" id="colJ">

    <div class="btn-grid">
        <button class="add" onclick="process('addData')">Data Add</button>
        <button class="delete" onclick="process('deleteData')">Data Delete</button>
        <button class="print-single" onclick="generateReport('single')">üñ®Ô∏è Print Single</button>
        <button class="print-summary" onclick="generateReport('summary')">üìä Print Summary List</button>
    </div>
</div>

<div id="report-area">
    <div class="header-container">
        <div class="header-left"><p>‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∑î,<br><span id="rAccountDisplay"></span>.</p></div>
        <div class="header-right">
            <h5 style="margin: 0;">‡∂á‡∂∏‡∑î‡∂´‡∑î‡∂∏ 4</h5>
            <p>‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∂∏‡∑î‡∂Ω ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂∏‡∑í‡∂≠‡∑í‡∂∫<br>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä<br>‡∂Ø‡∑í‡∂±‡∂∫: <span id="rDate"></span></p>
        </div>
    </div>
    <div class="report-title">‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ª‡∑î. <span id="rMainAmount"></span> ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ ‡∑Ñ‡∑è ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂ë‡∑Ä‡∑í‡∂∏‡∑ö ‡∂±‡∑í‡∑Ä‡∑ö‡∂Ø‡∂±‡∂∫</div>
    <p class="bold"><span id="rBankDisplay"></span> - <span id="rReceiptDisplay"></span></p>
    <table class="data-table">
        <tr><td style="width: 65%;">1. ‡∂Ö‡∂Ø‡∑è‡∂Ω ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫‡∂ß ‡∂Ω‡∂Ø ‡∂∏‡∑î‡∑Ö‡∑î ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ (‡∂ª‡∑î)</td><td style="text-align: right; font-weight: bold;" id="rTotalInt"></td></tr>
        <tr><td>2. ‡∂Ö‡∂©‡∑î ‡∂ö‡∂Ω‡∑è ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂∏‡∑í‡∂≠‡∑í‡∂∫ ‡∂ª‡∂≥‡∑Ä‡∑è‡∂ú‡∂≠‡∑ä ‡∂¥‡∑ú‡∂Ω‡∑í ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î)</td><td style="text-align: right; font-weight: bold;" id="rDeductedInt"></td></tr>
        <tr><td>3. ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä‡∂ß ‡∂ë‡∑Ä‡∂± ‡∂¥‡∑ú‡∂Ω‡∑í ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î)</td><td style="text-align: right; font-weight: bold;" id="rSentInt"></td></tr>
    </table>
    <div id="singleDetails">
        <table class="investment-table">
            <tr><td>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∂Ω ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î):</td><td id="rAmtBottom" style="text-align: right; font-weight: bold;"></td></tr>
            <tr><td>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∂Ω ‡∂ö‡∑è‡∂Ω‡∂∫:</td><td id="rPeriodText" style="text-align: right; font-weight: bold;"></td></tr>
            <tr><td>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∂Ω ‡∂¥‡∑ú‡∂Ω‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∑Å‡∂≠‡∂∫:</td><td id="rRateBottom" style="text-align: right; font-weight: bold;"></td></tr>
            <tr><td>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫:</td><td id="rMaturityDate" style="text-align: right; font-weight: bold;"></td></tr>
        </table>
    </div>
</div>

<div id="summary-report-area">
    <div class="header-container">
        <div class="header-left"><p>‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∑î,<br><span id="sAccountDisplay"></span>.</p></div>
        <div class="header-right"><p>‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∂∏‡∑î‡∂Ω ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂∏‡∑í‡∂≠‡∑í‡∂∫<br>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä<br>‡∂Ø‡∑í‡∂±‡∂∫: <span id="sDate"></span></p></div>
    </div>
    <div class="report-title">‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑ú‡∂Ω‡∑ì ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∑É‡∑è‡∂ª‡∑è‡∂Ç‡∑Å ‡∑Ä‡∑è‡∂ª‡∑ä‡∂≠‡∑è‡∑Ä</div>
    <table class="summary-table">
        <thead>
            <tr>
                <th>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫</th>
                <th>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∑Ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</th>
                <th>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î.)</th>
                <th>‡∂Ω‡∂Ø ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ (‡∂ª‡∑î.)</th>
                <th>‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫</th>
            </tr>
        </thead>
        <tbody id="summaryTableBody"></tbody>
    </table>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxOzu1pMPRGSpmq6qAH1HPTrVCsiejjit6jIyyOnHwdhj5kR_uOGyFxdGpQVx71WE6uDg/exec";

    function doLogin() {
        let u = document.getElementById('user').value, p = document.getElementById('pass').value;
        fetch(`${SCRIPT_URL}?action=login&username=${u}&password=${p}`, {method: 'POST'})
        .then(r => r.text()).then(res => {
            if(res.trim() === "success") {
                document.getElementById('login-area').style.display='none';
                document.getElementById('system-area').style.display='block';
            } else { alert("Login Failed!"); }
        });
    }

    function calculateDuration() {
        let s = new Date(document.getElementById('colC').value), e = new Date(document.getElementById('colG').value);
        if (!isNaN(s) && !isNaN(e)) {
            let diff = Math.ceil(Math.abs(e - s) / (1000 * 60 * 60 * 24));
            let sel = document.getElementById('colF');
            if (diff >= 25 && diff <= 35) sel.value = "‡∂∏‡∑è‡∑É 01";
            else if (diff >= 85 && diff <= 95) sel.value = "‡∂∏‡∑è‡∑É 03";
            else if (diff >= 170 && diff <= 190) sel.value = "‡∂∏‡∑è‡∑É 06";
        }
    }

    function addPercentSymbol(i) {
        let v = i.value.trim();
        if (v !== "" && !isNaN(v.replace('%',''))) i.value = v.replace('%','') + "%";
    }

    async function generateReport(type) {
        document.getElementById('report-area').classList.remove('active');
        document.getElementById('summary-report-area').classList.remove('active');
        
        const acc = document.getElementById('colA').value;
        const today = new Date().toISOString().split('T')[0];

        if(type === 'single') {
            document.getElementById('rAccountDisplay').innerText = acc;
            document.getElementById('rDate').innerText = today;
            const amt = parseFloat(document.getElementById('colE').value) || 0;
            const totalInt = parseFloat(document.getElementById('colI').value) || 0;
            document.getElementById('rMainAmount').innerText = amt.toLocaleString();
            document.getElementById('rTotalInt').innerText = totalInt.toLocaleString();
            document.getElementById('rDeductedInt').innerText = (totalInt * 0.07).toLocaleString();
            document.getElementById('rSentInt').innerText = (totalInt * 0.93).toLocaleString();
            document.getElementById('rAmtBottom').innerText = amt.toLocaleString();
            document.getElementById('rPeriodText').innerText = document.getElementById('colF').value;
            document.getElementById('rRateBottom').innerText = document.getElementById('colH').value;
            document.getElementById('rMaturityDate').innerText = document.getElementById('colG').value;
            document.getElementById('rBankDisplay').innerText = document.getElementById('colB').value;
            document.getElementById('rReceiptDisplay').innerText = document.getElementById('colD').value;
            document.getElementById('report-area').classList.add('active');
        } else {
            document.getElementById('sAccountDisplay').innerText = acc;
            document.getElementById('sDate').innerText = today;
            let html = `<tr>
                <td>${document.getElementById('colD').value}</td>
                <td>${document.getElementById('colB').value}</td>
                <td>${parseFloat(document.getElementById('colE').value).toLocaleString()}</td>
                <td>${document.getElementById('colI').value}</td>
                <td>${document.getElementById('colG').value}</td>
            </tr>`;
            document.getElementById('summaryTableBody').innerHTML = html;
            document.getElementById('summary-report-area').classList.add('active');
        }
        window.print();
    }

    async function process(action) {
        let fields = ['colA','colB','colC','colD','colE','colF','colG','colH','colI','colJ'], params = new URLSearchParams();
        if(action === 'searchData') params.append('colD', document.getElementById('searchId').value);
        else fields.forEach(f => params.append(f, document.getElementById(f).value));
        params.append('action', action);
        try {
            let res = await fetch(`${SCRIPT_URL}?${params.toString()}`, {method: 'POST'});
            let text = await res.text();
            if(action === 'searchData') {
                let data = JSON.parse(text);
                fields.forEach((f, i) => {
                    if((i===2 || i===6) && data[i]) document.getElementById(f).value = new Date(data[i]).toISOString().split('T')[0];
                    else document.getElementById(f).value = data[i] || "";
                });
            } else { alert(text); }
        } catch(e) { console.log(e); }
    }
</script>
</body>
</html>
