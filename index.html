<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment System Pro - Padiyathalawa</title>
    <style>
        body { font-family: sans-serif; font-size: 11pt; line-height: 1.2; background-color: #f4f7f6; margin: 0; padding: 0; }
        .header { background: #90caf9; padding: 20px; text-align: center; font-size: 18pt; font-weight: bold; }
        .container { background: white; max-width: 700px; margin: 20px auto; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; cursor: pointer; border: none; border-radius: 5px; color: white; font-weight: bold; transition: 0.3s; }
        .search-btn { background: #f1c40f; color: black; width: 100%; margin-top: 10px; }
        .add { background: #2ecc71; } 
        .delete { background: #e74c3c; }
        .print-btn { background: #9b59b6; }
        .list-btn { background: #34495e; }
        .clear-btn { background: #95a5a6; grid-column: span 2; }
        
        #login-area { text-align: center; } #system-area { display: none; }

        /* Report Layouts */
        #report-area, #list-report-area { display: none; background: white; width: 297mm; min-height: 210mm; margin: auto; padding: 15mm; box-sizing: border-box; color: black; }
        .report-header-flex { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .title-underlined { text-align: center; font-size: 14pt; font-weight: bold; text-decoration: underline; margin-bottom: 10px; }
        
        .list-table { width: 100%; border-collapse: collapse; font-size: 9.5pt; table-layout: fixed; }
        .list-table th, .list-table td { border: 1px solid #000; padding: 5px; text-align: center; }
        .list-table th { background-color: #f9f9f9; }

        .sig-container { display: flex; justify-content: space-between; margin-top: 50px; font-size: 10pt; }
        .sig-box { width: 45%; }

        @media print {
            @page { size: A4 landscape; margin: 5mm; }
            body { background: none; }
            .header, .container, .no-print { display: none !important; }
            #list-report-area, #report-area { display: block !important; }
        }
    </style>
</head>
<body>

<div class="header">‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∂∏‡∑ñ‡∂Ω ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂∏‡∑í‡∂≠‡∑í‡∂∫ - ‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä</div>

<div id="login-area" class="container">
    <h3 style="color: purple;">LOGIN</h3>
    <input type="text" id="user" placeholder="UserName">
    <input type="password" id="pass" placeholder="Password">
    <button style="background: #00bcd4; width: 100%;" onclick="doLogin()">Login</button>
</div>

<div id="system-area" class="container">
    <label>‡∑É‡∑ô‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label>
    <input type="text" id="searchId">
    <button class="search-btn" onclick="process('searchData')">üîç Data Search</button>
    <hr>
    
    <label>‡∂ú‡∑í‡∂´‡∑î‡∂∏‡∑ö ‡∂±‡∂∏:</label>
    <select id="colA"><option value="‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option><option value="‡∂¥‡∂Ω‡∑ä‡∂Ω‡∑ö‡∂ú‡∂∏ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂¥‡∂Ω‡∑ä‡∂Ω‡∑ö‡∂ú‡∂∏ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option></select>

    <label>‡∂Ü‡∂∫‡∑ù‡∂¢‡∑í‡∂≠ ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä:</label>
    <select id="colB"><option value="‡∂∏‡∑Ñ‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂∏‡∑Ñ‡∂¢‡∂± ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option><option value="‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä">‡∂Ω‡∂Ç‡∂ö‡∑è ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</option></select>

    <label>‡∂Ø‡∑í‡∂±‡∂∫:</label><input type="date" id="colC">
    <label>‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label><input type="text" id="colD">
    <label>‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î):</label><input type="number" id="colE">
    <label>‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫:</label><input type="date" id="colG">
    <label>‡∂ö‡∑è‡∂Ω‡∂∫:</label><select id="colF"><option value="‡∂∏‡∑è‡∑É 03">‡∂∏‡∑è‡∑É 03</option><option value="‡∂∏‡∑è‡∑É 06">‡∂∏‡∑è‡∑É 06</option></select>
    <label>‡∂¥‡∑ú‡∂Ω‡∑ì %:</label><input type="text" id="colH">
    <label>‡∂Ω‡∂Ø ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ (‡∂ª‡∑î):</label><input type="number" id="colI">
    <label>‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫:</label><input type="text" id="colJ">

    <div class="btn-grid">
        <button class="add" onclick="process('addData')">Data Add</button>
        <button class="delete" onclick="process('deleteData')">Data Delete</button>
        <button class="print-btn" onclick="generateReport()">üñ®Ô∏è Print & Save (Attch 4)</button>
        <button class="list-btn" onclick="generatePrintList()">üìã Print List (Attch 5)</button>
        <button class="clear-btn" onclick="clearPrintList()">üßπ Clear List</button>
    </div>
</div>

<div id="list-report-area">
    <div class="report-header-flex">
        <div>‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∑î,<br>‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫,<br>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä.</div>
        <div style="text-align: right;">‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫<br>‡∂¥‡∂Ø‡∑í‡∂∫‡∂≠‡∂Ω‡∑è‡∑Ä<br>‡∂Ø‡∑í‡∂±‡∂∫:- <span id="lCurrentDate"></span></div>
    </div>

    <div class="title-underlined">‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ ‡∑Ñ‡∑è ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂ë‡∑Ä‡∑í‡∂∏‡∑ö ‡∂±‡∑í‡∑Ä‡∑ö‡∂Ø‡∂±‡∂∫</div>
    <p style="font-size: 10pt;">‡∂¥‡∑Ñ‡∂≠ ‡∑É‡∂≥‡∑Ñ‡∂±‡∑ä ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∑Ä‡∂Ω‡∂ß ‡∂Ö‡∂Ø‡∑è‡∂Ω‡∑Ä, ‡∂Ω‡∂Ø ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫ ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫ ‡∑Ä‡∑í‡∑É‡∑í‡∂±‡∑ä ‡∂ª‡∂≥‡∑Ä‡∑è‡∂ú‡∂≠ ‡∂∫‡∑î‡∂≠‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂¥‡∑É‡∑î <span id="lCheckDisplay" style="font-weight:bold;"></span> ‡∂Ø‡∂ª‡∂´ ‡∂†‡∑ô‡∂ö‡∑ä‡∂¥‡∂≠ ‡∂∏‡∂ü‡∑í‡∂±‡∑ä ‡∂Ö‡∂∏‡∑î‡∂´‡∑è ‡∂ë‡∑Ä‡∂∏‡∑î.</p>
    
    <table class="list-table">
        <thead>
            <tr>
                <th rowspan="2" style="width:25px;">‡∂Ö‡∂Ç‡∂ö‡∂∫</th>
                <th colspan="3">‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑î‡∂´‡∑î ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª</th>
                <th colspan="3">‡∂¥‡∑ú‡∂Ω‡∑ì ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª</th>
                <th colspan="6">‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª</th>
            </tr>
            <tr>
                <th>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂∏‡∑î‡∂Ø‡∂Ω (‡∂ª‡∑î)</th>
                <th>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂±‡∂∫ ‡∂ö‡∑Ö ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</th>
                <th>‡∂Ü‡∂∫‡∑ù‡∂¢‡∂± ‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä‡∂¥‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫</th>
                <th>‡∂Ö‡∂Ø‡∑è‡∂Ω ‡∂∏‡∑î‡∑Ö‡∑î ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫</th>
                <th>‡∂ª‡∂≥‡∑Ä‡∑è‡∂ú‡∂≠‡∑ä 7% ‡∂¥‡∑ú‡∂Ω‡∑í‡∂∫</th>
                <th>‡∂ë‡∑Ä‡∂± ‡∂¥‡∑ú‡∂Ω‡∑í ‡∂∏‡∑î‡∂Ø‡∂Ω</th>
                <th>‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂Ü‡∂∫‡∑ù‡∂¢‡∑í‡∂≠ ‡∂Ø‡∑í‡∂±‡∂∫</th>
                <th>‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂Ü‡∂∫‡∑ù‡∂¢‡∑í‡∂≠ ‡∂∏‡∑î‡∂Ø‡∂Ω</th>
                <th>‡∑Ä‡∂ª‡∑ä‡∂ú‡∂∫</th>
                <th>‡∂ö‡∑è‡∂Ω‡∂∫</th>
                <th>‡∂¥‡∑ú‡∂Ω‡∑ì %</th>
                <th>‡∂ö‡∂Ω‡∑ä‡∂¥‡∑í‡∂ª‡∑ô‡∂± ‡∂Ø‡∑í‡∂±‡∂∫</th>
            </tr>
        </thead>
        <tbody id="list-table-body"></tbody>
    </table>

    <div class="sig-container">
        <div class="sig-box">
            ‡∂ú‡∑í‡∂´‡∑î‡∂∏‡∑ä ‡∂Ω‡∑í‡∂¥‡∑í‡∂ö‡∂ª‡∑î<br>‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫/‡∂∏‡∑ñ‡∂Ω‡∑É‡∑ä‡∂Æ‡∑è‡∂± ‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∑î<br>‡∂±‡∂∏:................................................<br>‡∂Ö‡∂≠‡∑ä‡∑É‡∂±:...........................................<br>‡∂Ø‡∑í‡∂±‡∂∫:..............................................
        </div>
        <div class="sig-box" style="text-align: left; padding-left: 50px;">
            ‡∂∂‡∂Ω‡∂∫‡∂Ω‡∂≠‡∑ä ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑ì ‡∑É‡∂∏‡∑ò‡∂Ø‡∑ä‡∂∞‡∑í ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î ‡∂∏‡∑Ñ ‡∑É‡∂Ç‡∂ú‡∂∏‡∂∫/‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂Ø‡∑ö‡∑Å‡∑ì‡∂∫ ‡∂Ω‡∑ö‡∂ö‡∂∏‡∑ä<br>‡∂±‡∂∏:................................................<br>‡∂Ö‡∂≠‡∑ä‡∑É‡∂±:...........................................<br>‡∂Ø‡∑í‡∂±‡∂∫:..............................................
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "‡∂î‡∂∂‡∑ö_SCRIPT_URL_‡∂ë‡∂ö_‡∂∏‡∑ô‡∂≠‡∑ê‡∂±‡∂ß_‡∂∫‡∑ú‡∂Ø‡∂±‡∑ä‡∂±";

    function doLogin() {
        let u = document.getElementById('user').value, p = document.getElementById('pass').value;
        fetch(`${SCRIPT_URL}?action=login&username=${u}&password=${p}`, {method: 'POST'})
        .then(r => r.text()).then(res => {
            if(res.trim() === "success") { document.getElementById('login-area').style.display='none'; document.getElementById('system-area').style.display='block'; }
            else { alert("Login Failed!"); }
        });
    }

    async function process(actionName) {
        let params = new URLSearchParams();
        if(actionName === 'searchData') { params.append('colD', document.getElementById('searchId').value); }
        else { ['colA','colB','colC','colD','colE','colF','colG','colH','colI','colJ'].forEach(f => params.append(f, document.getElementById(f).value)); }
        params.append('action', actionName);
        
        let res = await fetch(`${SCRIPT_URL}?${params.toString()}`, {method: 'POST'});
        let text = await res.text();
        
        if(actionName === 'searchData' && text !== "notfound") {
            let data = JSON.parse(text);
            document.getElementById('colA').value = data[0];
            document.getElementById('colB').value = data[1];
            document.getElementById('colC').value = data[2] ? new Date(data[2]).toISOString().split('T')[0] : "";
            document.getElementById('colD').value = data[3];
            document.getElementById('colE').value = data[4];
            document.getElementById('colF').value = data[5];
            document.getElementById('colG').value = data[6] ? new Date(data[6]).toISOString().split('T')[0] : "";
            document.getElementById('colH').value = data[7];
            document.getElementById('colI').value = data[8];
            document.getElementById('colJ').value = data[9];
            alert("‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∑Ñ‡∂∏‡∑î‡∑Ä‡∑í‡∂∫!");
        } else if(text.includes("success")) { alert("‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í!"); }
    }

    async function generatePrintList() {
        const acc = document.getElementById('colA').value;
        document.getElementById('lCurrentDate').innerText = new Date().toISOString().split('T')[0];
        document.getElementById('lCheckDisplay').innerText = document.getElementById('colJ').value || ".........";

        let resp = await fetch(`${SCRIPT_URL}?action=getPrintList`);
        let data = await resp.json();
        let tbody = document.getElementById('list-table-body');
        tbody.innerHTML = "";
        
        let t1=0, t2=0, t3=0, count=0;

        data.forEach((row) => {
            if(row[0] === acc) {
                count++;
                let inv = parseFloat(row[4]) || 0, intr = parseFloat(row[8]) || 0;
                let tax = intr * 0.07, net = intr - tax;
                t1+=intr; t2+=tax; t3+=net;

                tbody.innerHTML += `<tr>
                    <td>${count}</td>
                    <td style="text-align:right">${inv.toLocaleString()}</td>
                    <td>${row[1]}</td>
                    <td>${row[3]}</td>
                    <td style="text-align:right">${intr.toFixed(2)}</td>
                    <td style="text-align:right">${tax.toFixed(2)}</td>
                    <td style="text-align:right">${net.toFixed(2)}</td>
                    <td>${row[2] ? new Date(row[2]).toISOString().split('T')[0] : ""}</td>
                    <td style="text-align:right">${inv.toLocaleString()}</td>
                    <td>‡∑É‡∑ä‡∂Æ‡∑ì‡∂ª</td>
                    <td>${row[5]}</td>
                    <td>${row[7]}</td>
                    <td>${row[6] ? new Date(row[6]).toISOString().split('T')[0] : ""}</td>
                </tr>`;
            }
        });

        if(count > 0) {
            tbody.innerHTML += `<tr style="font-weight:bold; background:#eee"><td colspan="4">‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä</td><td style="text-align:right">${t1.toFixed(2)}</td><td style="text-align:right">${t2.toFixed(2)}</td><td style="text-align:right">${t3.toFixed(2)}</td><td colspan="6"></td></tr>`;
            document.getElementById('system-area').style.display = 'none';
            document.getElementById('list-report-area').style.display = 'block';
            window.print();
            location.reload(); 
        } else { alert("‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂±‡∑ê‡∂≠!"); }
    }

    function generateReport() {
        // Attachment 4 ‡∂ö‡∑ö‡∂≠‡∂∫ ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂≠‡∑í‡∂∂‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫ (‡∂¥‡∑ô‡∂ª ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑î‡∂±‡∑ä ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫‡∂ß‡∂∏)
        alert("Attachment 4 ‡∑É‡∂ö‡∑É‡∑ä ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...");
        window.print();
    }

    async function clearPrintList() { if(confirm("‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä ‡∂∏‡∂ö‡∂±‡∑ä‡∂±‡∂Ø?")) { await fetch(`${SCRIPT_URL}?action=clearPrintSheet`, {method: 'POST'}); alert("‡∂∏‡∂ö‡∑è ‡∂Ø‡∂∏‡∂± ‡∂Ω‡∂Ø‡∑ì."); } }
</script>
</body>
</html>
